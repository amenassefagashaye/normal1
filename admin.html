<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ä†·à∞·çã ·â¢·äï·åé - ·ä†·àµ·â∞·ã≥·ã∞·à≠</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Ethiopic:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="admin-container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <div class="login-box">
                <div class="login-header amharic-text">
                    <h2>·ä†·àµ·â∞·ã≥·ã∞·à≠ ·àò·åç·â¢·ã´</h2>
                    <p>·ä•·â£·ä≠·ãé ·ã®·ã≠·àà·çç ·âÉ·àç ·ã´·àµ·åà·â°</p>
                </div>
                <div class="login-form">
                    <div class="form-group">
                        <input type="text" id="adminUsername" placeholder="·ã®·â∞·å†·âÉ·àö ·àµ·àù" value="admin" readonly>
                    </div>
                    <div class="form-group">
                        <input type="password" id="adminPassword" placeholder="·ã®·ã≠·àà·çç ·âÉ·àç">
                    </div>
                    <button class="login-btn" onclick="adminLogin()">·åç·â£</button>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="admin-dashboard" style="display: none;">
            <div class="admin-header">
                <div class="admin-title">
                    <h1 class="amharic-text">·ä†·à∞·çã ·â¢·äï·åé - ·ä†·àµ·â∞·ã≥·ã∞·à≠</h1>
                    <p id="serverTime">Server: Connected</p>
                </div>
                <div class="admin-controls">
                    <button class="admin-btn btn-danger" onclick="logout()">·ãç·å£</button>
                    <button class="admin-btn btn-refresh" onclick="refreshDashboard()">üîÑ</button>
                </div>
            </div>

            <div class="dashboard-grid">
                <!-- Game Control Panel -->
                <div class="dashboard-card game-control">
                    <h3 class="amharic-text">·ã®·å®·ãã·â≥ ·àò·âÜ·å£·å†·à™·ã´</h3>
                    <div class="control-section">
                        <div class="control-group">
                            <label class="amharic-text">·ã®·å®·ãã·â≥ ·ä†·ã≠·äê·âµ</label>
                            <select id="adminGameType" class="admin-select">
                                <option value="75ball">75-·â¢·äï·åé</option>
                                <option value="90ball">90-·â¢·äï·åé</option>
                                <option value="30ball">30-·â¢·äï·åé</option>
                                <option value="50ball">50-·â¢·äï·åé</option>
                                <option value="pattern">·äï·ãµ·çç ·â¢·äï·åé</option>
                                <option value="coverall">·àô·àâ ·â§·âµ</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label class="amharic-text">·ãç·à≠·à≠·ãµ ·àò·å†·äï</label>
                            <select id="adminStake" class="admin-select">
                                <option value="25">25 ·â•·à≠</option>
                                <option value="50">50 ·â•·à≠</option>
                                <option value="100">100 ·â•·à≠</option>
                                <option value="200">200 ·â•·à≠</option>
                                <option value="500">500 ·â•·à≠</option>
                                <option value="1000">1000 ·â•·à≠</option>
                                <option value="2000">2000 ·â•·à≠</option>
                                <option value="5000">5000 ·â•·à≠</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label class="amharic-text">·ä®·çç·â∞·äõ ·â∞·å´·ãã·âæ·âΩ</label>
                            <input type="number" id="adminMaxPlayers" class="admin-input" value="90" min="2" max="200">
                        </div>
                        <div class="control-buttons">
                            <button class="admin-btn btn-success" id="startGameBtn" onclick="startGame()">·å®·ãã·â≥ ·åÄ·àù·à≠</button>
                            <button class="admin-btn btn-danger" id="stopGameBtn" onclick="stopGame()" disabled>·å®·ãã·â≥ ·ä†·âÅ·àù</button>
                            <button class="admin-btn btn-warning" id="resetGameBtn" onclick="resetGame()">·ä•·äï·ã∞·åà·äì ·åÄ·àù·à≠</button>
                        </div>
                    </div>
                </div>

                <!-- Number Calling Panel -->
                <div class="dashboard-card number-control">
                    <h3 class="amharic-text">·ã®·âÅ·å•·à≠ ·å•·à™</h3>
                    <div class="number-section">
                        <div class="current-number-display">
                            <div class="number-label amharic-text">·ã®·ä†·àÅ·äë ·âÅ·å•·à≠</div>
                            <div class="number-value" id="currentNumberDisplay">-</div>
                        </div>
                        <div class="number-controls">
                            <button class="number-btn btn-call" onclick="callNextNumber()">·âÅ·å•·à≠ ·å•·à´</button>
                            <button class="number-btn btn-auto" id="autoCallBtn" onclick="toggleAutoCall()">·à´·àµ-·à∞·à≠ ·å•·à™</button>
                            <button class="number-btn btn-undo" onclick="undoLastCall()">·â∞·àò·àà·àµ</button>
                        </div>
                        <div class="called-numbers">
                            <h4 class="amharic-text">·ã®·â∞·å†·à© ·âÅ·å•·àÆ·âΩ</h4>
                            <div class="called-list" id="adminCalledNumbers">
                                <!-- Called numbers will appear here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Players Management -->
                <div class="dashboard-card players-management">
                    <h3 class="amharic-text">·ã®·â∞·å´·ãã·âæ·âΩ ·ä†·àµ·â∞·ã≥·ã∞·à≠</h3>
                    <div class="players-stats">
                        <div class="stat-item">
                            <span class="stat-label">·å†·âÖ·àã·àã:</span>
                            <span class="stat-value" id="totalPlayers">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">·â†·àò·å´·ãà·âµ ·àã·ã≠:</span>
                            <span class="stat-value" id="activePlayers">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">·ãù·åç·åÅ:</span>
                            <span class="stat-value" id="readyPlayers">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">·ä†·à∏·äì·çä·ãé·âΩ:</span>
                            <span class="stat-value" id="winnersCount">0</span>
                        </div>
                    </div>
                    <div class="players-list-container">
                        <div class="players-header">
                            <input type="text" id="adminPlayerSearch" placeholder="·â∞·å´·ãã·âΩ ·çà·àç·åç..." class="search-input">
                            <button class="refresh-btn" onclick="refreshPlayers()">üîÑ</button>
                        </div>
                        <div class="players-table-container">
                            <table class="players-table">
                                <thead>
                                    <tr>
                                        <th class="amharic-text">·â∞.·âÅ.</th>
                                        <th class="amharic-text">·àµ·àù</th>
                                        <th class="amharic-text">·àµ·àç·ä≠</th>
                                        <th class="amharic-text">·ãç·à≠·à≠·ãµ</th>
                                        <th class="amharic-text">·àÅ·äî·â≥</th>
                                        <th class="amharic-text">·â∞·åç·â£·à≠</th>
                                    </tr>
                                </thead>
                                <tbody id="adminPlayersList">
                                    <!-- Players will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Game Statistics -->
                <div class="dashboard-card game-stats">
                    <h3 class="amharic-text">·ã®·å®·ãã·â≥ ·àµ·â≥·â≤·àµ·â≤·ä≠·àµ</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-info">
                                <div class="stat-title amharic-text">·å†·âÖ·àã·àã ·ãç·à≠·à≠·ãµ</div>
                                <div class="stat-value" id="totalStakes">0 ·â•·à≠</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üèÜ</div>
                            <div class="stat-info">
                                <div class="stat-title amharic-text">·å†·âÖ·àã·àã ·àΩ·àç·àõ·âµ</div>
                                <div class="stat-value" id="totalPrizes">0 ·â•·à≠</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <div class="stat-info">
                                <div class="stat-title amharic-text">·ã®·å®·ãã·â≥ ·åä·ãú</div>
                                <div class="stat-value" id="gameDuration">00:00</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üî¢</div>
                            <div class="stat-info">
                                <div class="stat-title amharic-text">·ã®·â∞·å†·à© ·âÅ·å•·àÆ·âΩ</div>
                                <div class="stat-value" id="totalCalled">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="winners-list">
                        <h4 class="amharic-text">·ã®·âÖ·à≠·â• ·åä·ãú ·ä†·à∏·äì·çä·ãé·âΩ</h4>
                        <div class="winners-container" id="recentWinners">
                            <!-- Recent winners will appear here -->
                        </div>
                    </div>
                </div>

                <!-- System Controls -->
                <div class="dashboard-card system-controls">
                    <h3 class="amharic-text">·ã®·àµ·à≠·ãì·âµ ·àò·âÜ·å£·å†·à™·ã´·ãé·âΩ</h3>
                    <div class="system-section">
                        <div class="control-group">
                            <label class="amharic-text">·ã®·å®·ãã·â≥ ·çç·å•·äê·âµ</label>
                            <div class="slider-container">
                                <input type="range" id="gameSpeed" min="3" max="15" value="7" class="speed-slider">
                                <span id="speedValue">7 ·à∞·ä®·äï·ãµ</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="amharic-text">·ã®·àõ·à≥·ãà·âÇ·ã´</label>
                            <textarea id="adminAnnouncement" class="announcement-input" placeholder="·àõ·à≥·ãà·âÇ·ã´ ·ã≠·åª·çâ..." rows="3"></textarea>
                            <button class="admin-btn btn-info" onclick="sendAnnouncement()">·àã·ä≠</button>
                        </div>
                        <div class="control-group">
                            <label class="amharic-text">·ã®·å®·ãã·â≥ ·àï·åç</label>
                            <select id="gameRules" class="admin-select">
                                <option value="standard">·àò·ã∞·â†·äõ</option>
                                <option value="quick">·çà·å£·äï</option>
                                <option value="pattern">·äï·ãµ·çç</option>
                                <option value="coverall">·àô·àâ ·â§·âµ</option>
                            </select>
                        </div>
                        <div class="system-buttons">
                            <button class="admin-btn btn-warning" onclick="backupGame()">·â∞·å†·âÉ·àö ·àò·à®·åÉ ·ä†·àµ·âÄ·àù·å•</button>
                            <button class="admin-btn btn-danger" onclick="clearAllData()">·àÅ·àâ·äï·àù ·àò·à®·åÉ·ãé·âΩ ·ä†·å•·çã</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Chat Monitor -->
            <div class="chat-monitor">
                <h3 class="amharic-text">·ã®·âÄ·å•·â≥ ·ãç·ã≠·ã≠·âµ</h3>
                <div class="chat-monitor-container">
                    <div class="chat-messages-admin" id="adminChatMessages">
                        <!-- Chat messages will appear here -->
                    </div>
                    <div class="chat-controls">
                        <input type="text" id="adminChatInput" placeholder="·àò·àç·ä•·ä≠·âµ ·ã≠·åª·çâ..." class="chat-input-admin">
                        <button class="chat-send-btn" onclick="sendAdminMessage()">‚û§</button>
                        <button class="chat-clear-btn" onclick="clearChat()">üóëÔ∏è</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="callAudio" src="assets/call.mp3" preload="auto"></audio>
    <audio id="winAudio" src="assets/win.mp3" preload="auto"></audio>

    <!-- Admin JavaScript -->
    <script src="client.js"></script>
    <script>
        // Admin-specific functions
        let adminWs = null;
        let adminAuthenticated = false;

        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === 'asse2123') {
                adminAuthenticated = true;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                connectAdminWebSocket();
            } else {
                alert('·ã®·ã≠·àà·çç ·âÉ·àç ·âµ·ä≠·ä≠·àç ·ä†·ã≠·ã∞·àà·àù!');
            }
        }

        function connectAdminWebSocket() {
            const wsUrl = window.location.hostname === 'localhost' 
                ? 'ws://localhost:8080/ws/admin'
                : `wss://${window.location.hostname}/ws/admin`;
            
            adminWs = new WebSocket(wsUrl);

            adminWs.onopen = function() {
                console.log('Admin WebSocket connected');
                // Send authentication
                adminWs.send(JSON.stringify({
                    type: 'admin_auth',
                    password: 'asse2123'
                }));
            };

            adminWs.onmessage = function(event) {
                const data = JSON.parse(event.data);
                handleAdminMessage(data);
            };

            adminWs.onclose = function() {
                console.log('Admin WebSocket disconnected');
                setTimeout(connectAdminWebSocket, 3000);
            };

            adminWs.onerror = function(error) {
                console.error('Admin WebSocket error:', error);
            };
        }

        function handleAdminMessage(data) {
            switch(data.type) {
                case 'admin_auth_success':
                    console.log('Admin authenticated successfully');
                    break;
                case 'game_state':
                    updateGameState(data.state);
                    break;
                case 'player_list':
                    updatePlayerList(data.players);
                    break;
                case 'game_stats':
                    updateGameStats(data.stats);
                    break;
                case 'chat_message':
                    addChatMessage(data.message);
                    break;
                case 'winner':
                    showWinnerNotification(data);
                    break;
                case 'number_called':
                    updateCalledNumbers(data);
                    break;
            }
        }

        function startGame() {
            const gameType = document.getElementById('adminGameType').value;
            const stake = document.getElementById('adminStake').value;
            const maxPlayers = document.getElementById('adminMaxPlayers').value;

            adminWs.send(JSON.stringify({
                type: 'start_game',
                gameType: gameType,
                stake: parseInt(stake),
                maxPlayers: parseInt(maxPlayers)
            }));
        }

        function stopGame() {
            adminWs.send(JSON.stringify({
                type: 'stop_game'
            }));
        }

        function callNextNumber() {
            adminWs.send(JSON.stringify({
                type: 'call_number'
            }));
        }

        function toggleAutoCall() {
            const btn = document.getElementById('autoCallBtn');
            const autoCalling = btn.classList.contains('active');
            
            adminWs.send(JSON.stringify({
                type: 'toggle_auto_call',
                autoCall: !autoCalling
            }));
        }

        function sendAnnouncement() {
            const message = document.getElementById('adminAnnouncement').value;
            if (message.trim()) {
                adminWs.send(JSON.stringify({
                    type: 'announcement',
                    message: message
                }));
                document.getElementById('adminAnnouncement').value = '';
            }
        }

        function updateGameState(state) {
            document.getElementById('startGameBtn').disabled = state.status === 'running';
            document.getElementById('stopGameBtn').disabled = state.status !== 'running';
            
            if (state.currentNumber) {
                document.getElementById('currentNumberDisplay').textContent = state.currentNumber;
            }
        }

        function updatePlayerList(players) {
            const tbody = document.getElementById('adminPlayersList');
            tbody.innerHTML = '';
            
            players.forEach((player, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${player.name}</td>
                    <td>${player.phone}</td>
                    <td>${player.stake} ·â•·à≠</td>
                    <td><span class="status-badge ${player.status}">${player.status}</span></td>
                    <td>
                        <button class="action-btn" onclick="kickPlayer('${player.id}')">üèÉ</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('totalPlayers').textContent = players.length;
            document.getElementById('activePlayers').textContent = players.filter(p => p.status === 'playing').length;
            document.getElementById('readyPlayers').textContent = players.filter(p => p.status === 'ready').length;
        }

        function kickPlayer(playerId) {
            if (confirm('·ã≠·àÖ·äï ·â∞·å´·ãã·âΩ ·àà·àõ·àµ·ãà·åà·ãµ ·ä•·à≠·åç·å†·äõ ·äê·ãé·âµ?')) {
                adminWs.send(JSON.stringify({
                    type: 'kick_player',
                    playerId: playerId
                }));
            }
        }

        function logout() {
            adminAuthenticated = false;
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('adminDashboard').style.display = 'none';
            if (adminWs) {
                adminWs.close();
            }
        }

        // Initialize on load
        window.addEventListener('load', function() {
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    adminLogin();
                }
            });
        });
    </script>
</body>
</html>